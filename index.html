<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‘ì—… ë§ˆê° ì‹œë®¬ë ˆì´í„°</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FKL4VTY5LL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FKL4VTY5LL');
</script>
<style>
:root {
  --bg:#0e0e12; --surface:#16161e; --s2:#1e1e2a; --border:#2a2a3a;
  --red:#ff6b6b; --yellow:#ffd93d; --green:#6bcb77; --blue:#6b9bcb;
  --text:#e8e8f0; --t2:#8888aa; --t3:#555570;
  --r:12px; --tr:.2s ease;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;min-height:100vh;padding:24px 16px 80px}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:.4}

header{max-width:820px;margin:0 auto 32px;display:flex;align-items:baseline;gap:12px}
header h1{font-size:22px;font-weight:900;letter-spacing:-.5px}
header h1 span{color:var(--red)}
header p{font-size:12px;color:var(--t3);font-family:'Space Mono',monospace}

.wrap{max-width:820px;margin:0 auto;display:flex;flex-direction:column;gap:16px}

.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:24px}
.card-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--red);margin-bottom:20px}
.sec{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--t2);margin-bottom:10px}

/* ì¸í’‹ ê³µí†µ */
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-size:11px;color:var(--t2);font-weight:600;letter-spacing:.5px;text-transform:uppercase}
input[type=text],input[type=number],input[type=date],textarea{background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:14px;outline:none;transition:border-color var(--tr);width:100%}
input:focus,textarea:focus{border-color:var(--red)}
input[type=date]::-webkit-calendar-picker-indicator{filter:invert(.5);cursor:pointer}

.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:14px}

/* íƒ€ì… í† ê¸€ */
.type-row{display:flex;gap:8px;margin-bottom:14px}
.tbtn{flex:1;padding:9px 6px;border:1px solid var(--border);background:var(--s2);color:var(--t2);border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;font-family:'Noto Sans KR',sans-serif;transition:all var(--tr);text-align:center}
.tbtn.on{background:var(--red);color:#fff;border-color:var(--red)}

/* ë‹¨ê³„ ì¶”ê°€ ë°•ìŠ¤ */
.adder{background:var(--s2);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px}
.adder-row{display:flex;gap:8px;align-items:center;margin-bottom:4px}
.adder-row input[type=text]{flex:1;background:var(--bg);border-radius:6px;padding:9px 12px;font-size:13px}
.adder-row input[type=date]{background:var(--bg);border-radius:6px;padding:9px 10px;font-size:12px;width:145px;flex-shrink:0}
.hint{font-size:10px;color:var(--t3)}

.btn-g{padding:9px 16px;background:var(--green);color:#0e0e12;border:none;border-radius:6px;font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all var(--tr);white-space:nowrap}
.btn-g:hover{background:#55c462}
.btn-r{width:100%;padding:12px;background:var(--red);color:#fff;border:none;border-radius:8px;font-family:'Noto Sans KR',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all var(--tr)}
.btn-r:hover{background:#ff4f4f;transform:translateY(-1px)}

/* ë¯¸ë¦¬ë³´ê¸° */
.preview-list{margin-top:10px;display:flex;flex-direction:column;gap:6px}
.preview-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px}
.preview-left{display:flex;align-items:center;gap:8px}
.preview-name{font-size:13px;font-weight:600}
.bdg-date{font-family:'Space Mono',monospace;font-size:10px;padding:2px 7px;border-radius:4px;background:rgba(255,217,61,.1);color:var(--yellow)}
.btn-x{background:none;border:none;color:var(--t3);cursor:pointer;font-size:16px;line-height:1;padding:2px 6px;border-radius:4px;transition:all var(--tr)}
.btn-x:hover{color:var(--red);background:rgba(255,107,107,.1)}

/* í”„ë¡œì íŠ¸ ì¹´ë“œ */
.pcard{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;animation:si .3s ease}
@keyframes si{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}

.phead{padding:18px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);cursor:pointer;user-select:none}
.phead:hover{background:var(--s2)}
.ptitle{display:flex;align-items:center;gap:10px;flex:1;min-width:0}
.pname{font-size:15px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.dday{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;padding:3px 9px;border-radius:5px;white-space:nowrap;flex-shrink:0}
.urg{background:rgba(255,107,107,.2);color:var(--red)}
.wrn{background:rgba(255,217,61,.15);color:var(--yellow)}
.ok{background:rgba(107,203,119,.15);color:var(--green)}
.dn{background:rgba(100,100,120,.2);color:var(--t3)}

.pright{display:flex;align-items:center;gap:6px;flex-shrink:0}
.del-btn{background:none;border:none;color:var(--t3);cursor:pointer;font-size:22px;line-height:1;padding:4px 8px;border-radius:6px;transition:all var(--tr);font-weight:300}
.del-btn:hover{background:rgba(255,107,107,.15);color:var(--red)}

.chv{width:16px;height:16px;color:var(--t3);transition:transform .3s ease;flex-shrink:0}
.pcard.open .chv{transform:rotate(180deg)}

.pbody{display:none;padding:24px;flex-direction:column;gap:20px}
.pcard.open .pbody{display:flex}

/* ì§„í–‰ë¥  */
.dp{display:flex;flex-direction:column;gap:10px}
.prog-row{display:flex;flex-direction:column;gap:5px}
.prog-top{display:flex;justify-content:space-between;align-items:baseline}
.prog-label{font-size:11px;color:var(--t2);font-weight:600;text-transform:uppercase;letter-spacing:1px}
.prog-val{font-family:'Space Mono',monospace;font-size:16px;font-weight:700}
.bar{height:8px;background:var(--s2);border-radius:20px;overflow:hidden;border:1px solid var(--border)}
.bar-fill-g{height:100%;border-radius:20px;background:linear-gradient(90deg,var(--green),#4dc957);transition:width .5s cubic-bezier(.4,0,.2,1)}
.bar-fill-b{height:100%;border-radius:20px;background:linear-gradient(90deg,var(--blue),#4d7dc9);transition:width .5s cubic-bezier(.4,0,.2,1)}
.prog-sub{font-size:11px;color:var(--t3);font-family:'Space Mono',monospace}

/* ë‹¨ê³„ ë¸”ë¡ */
.slist{display:flex;flex-direction:column;gap:10px}
.sblock{background:var(--s2);border:1px solid var(--border);border-radius:10px;overflow:hidden}
.sblock.ok-block{border-color:rgba(107,203,119,.3)}

.shead{padding:10px 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02);transition:background var(--tr)}
.shead:hover{background:rgba(255,255,255,.05)}
.sblock-head-wrap{display:flex;align-items:center;gap:10px}
.shead-left{display:flex;align-items:center;gap:8px}
.sname{font-size:13px;font-weight:700}
.sdday{font-family:'Space Mono',monospace;font-size:10px;padding:2px 7px;border-radius:4px}
.spct{font-family:'Space Mono',monospace;font-size:13px;font-weight:700}
.ok-block .spct{color:var(--green)}

.sbody{padding:12px 14px;display:flex;flex-direction:column;gap:10px}

/* ì›¹íˆ° ì‘ì—… ì…ë ¥ */
.winrow{display:flex;gap:8px;align-items:center}
.winwrap{position:relative;display:flex;align-items:center;flex:1}
.winwrap input{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:8px 38px 8px 12px;color:var(--text);font-family:'Space Mono',monospace;font-size:14px;font-weight:700;outline:none;transition:border-color var(--tr);width:100%}
.winwrap input:focus{border-color:var(--green)}
.wunit{position:absolute;right:10px;font-size:11px;color:var(--t3)}
.btn-rec{padding:8px 14px;background:var(--red);color:#fff;border:none;border-radius:6px;font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all var(--tr);white-space:nowrap}
.btn-rec:hover{background:#ff4f4f}

/* ë‹¨ê³„ ë°” */
.sbar-row{display:flex;flex-direction:column;gap:4px}
.sbar-top{display:flex;justify-content:space-between}
.sbar-txt{font-size:11px;color:var(--t3);font-family:'Space Mono',monospace}

/* ì²´í¬ë°•ìŠ¤ (ì¼ëŸ¬ìŠ¤íŠ¸) */
.cbrow{display:flex;align-items:center;gap:10px;cursor:pointer;padding:4px 0}
.cb{width:20px;height:20px;flex-shrink:0;border:2px solid var(--border);border-radius:5px;display:flex;align-items:center;justify-content:center;background:var(--bg);transition:all var(--tr)}
.cb.on{background:var(--green);border-color:var(--green)}
.cb svg{display:none}
.cb.on svg{display:block}
.cblabel{font-size:13px;font-weight:600}
.cbrow.done .cblabel{text-decoration:line-through;color:var(--t3)}

/* ë¡œê·¸ */
.loglist{display:flex;flex-direction:column;gap:4px;max-height:140px;overflow-y:auto}
.loglist::-webkit-scrollbar{width:3px}
.loglist::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.logitem{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--bg);border-radius:6px;border:1px solid var(--border)}
.log-btns{display:flex;gap:4px;margin-left:auto;flex-shrink:0}
.log-edit-btn,.log-del-btn{background:none;border:1px solid var(--border);border-radius:4px;font-size:10px;padding:2px 7px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all var(--tr)}
.log-edit-btn{color:var(--t2)}
.log-edit-btn:hover{color:var(--yellow);border-color:var(--yellow);background:rgba(255,217,61,.08)}
.log-del-btn{color:var(--t3)}
.log-del-btn:hover{color:var(--red);border-color:var(--red);background:rgba(255,107,107,.08)}
.ldate{font-family:'Space Mono',monospace;font-size:10px;color:var(--t3);min-width:76px}
.lamt{font-family:'Space Mono',monospace;font-weight:700;color:var(--green);min-width:50px}
.lnote{color:var(--t2);font-size:11px}

/* ì¹´ë“œ ë‚´ ë‹¨ê³„ì¶”ê°€ */
.inline-adder{background:var(--s2);border:1px dashed var(--border);border-radius:8px;padding:12px}
.inline-adder-row{display:flex;gap:8px;align-items:center;margin-bottom:4px}
.inline-adder-row input[type=text]{flex:1;background:var(--bg);border-radius:6px;padding:8px 12px;font-size:13px}
.inline-adder-row input[type=date]{background:var(--bg);border-radius:6px;padding:8px 10px;font-size:12px;width:140px;flex-shrink:0}

/* ë©”ëª¨ */
.memo{min-height:56px;resize:vertical}
.memo::placeholder{color:var(--t3)}

/* ë‹¨ê³„ ì´ë¦„ ì¹© */
.stage-chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
.schip{padding:5px 12px;background:var(--bg);border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:600;color:var(--t2);cursor:pointer;transition:all var(--tr);font-family:'Noto Sans KR',sans-serif}
.schip:hover{border-color:var(--green);color:var(--green)}
.schip.custom-chip{border-style:dashed}

/* ë‹¨ê³„ ì§ì ‘ì…ë ¥ (ì¹© ì„ íƒ í›„ í‘œì‹œ) */
.custom-input-row{display:none;flex-direction:column;gap:8px;margin-top:8px}
.custom-input-row.show{display:flex}
.custom-input-row input[type=text],.custom-input-row input[type=date]{width:100%;background:var(--surface) !important;border:1px solid var(--border) !important;border-radius:6px;padding:8px 12px;font-size:13px;color:var(--text) !important}
.custom-input-row input::placeholder{color:var(--t2) !important}
.custom-input-row .btn-g{width:100%}

/* ë‹¨ê³„ ë¸”ë¡ í† ê¸€ */
.sblock-head-wrap{display:flex;align-items:center;justify-content:space-between}
.stoggle-btn{background:none;border:none;color:var(--t3);cursor:pointer;font-size:11px;padding:2px 6px;border-radius:4px;transition:all var(--tr);font-family:'Space Mono',monospace;white-space:nowrap}
.stoggle-btn:hover{color:var(--t2);background:rgba(255,255,255,.05)}
.sblock-collapsed .sbody{display:none}

/* ë‚ ì§œ íŒì—… */
.date-popup{display:none;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;margin-top:8px;flex-direction:column;gap:10px}
.date-popup.show{display:flex}
.popup-label{font-size:12px;font-weight:700;color:var(--t2)}
.popup-date{background:var(--s2);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;outline:none;width:100%}
.popup-date:focus{border-color:var(--green)}
.popup-date::-webkit-calendar-picker-indicator{filter:invert(.5);cursor:pointer}
.popup-ok{width:100%;padding:8px;background:var(--green);border:none;border-radius:6px;color:#0e0e12;font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all var(--tr)}
.popup-ok:hover{background:#55c462}
.popup-hint{font-size:10px;color:var(--t3)}

/* ì»· ìˆ˜ ìˆ˜ì • ë²„íŠ¼ */
.edit-cuts-btn{background:none;border:none;color:var(--t3);cursor:pointer;font-size:10px;padding:1px 5px;border-radius:4px;margin-left:6px;transition:all var(--tr);font-family:'Noto Sans KR',sans-serif}
.edit-cuts-btn:hover{color:var(--yellow);background:rgba(255,217,61,.1)}

/* ë‹¨ê³„ ì‚­ì œ ë²„íŠ¼ */
.sdel-btn{background:none;border:none;color:var(--t3);cursor:pointer;font-size:13px;padding:2px 4px;border-radius:4px;transition:all var(--tr);line-height:1}
.sdel-btn:hover{color:var(--red);background:rgba(255,107,107,.1)}

/* ë¹ˆ ìƒíƒœ */
.empty{text-align:center;padding:48px 24px;color:var(--t3);font-size:13px;font-family:'Space Mono',monospace;background:var(--surface);border:1px dashed var(--border);border-radius:var(--r)}
.empty p:first-child{font-size:32px;margin-bottom:12px}

@media(max-width:560px){.row2,.row3{grid-template-columns:1fr}.type-row{flex-wrap:wrap}.adder-row{flex-wrap:wrap}.adder-row input[type=date]{width:100%}}
</style>
</head>
<body>

<header>
  <h1>ì‘ì—… <span>ë§ˆê°</span> ì‹œë®¬ë ˆì´í„°</h1>
  <p>// deadline manager</p>
</header>

<div class="wrap">
  <div class="card">
    <div class="card-title">+ ìƒˆ ì‘ì—… ì¶”ê°€</div>

    <div class="row2">
      <div class="field">
        <label>ì‘ì—… ì´ë¦„</label>
        <input type="text" id="inp-name" placeholder="ì˜ˆ: OOë‹˜ ì‘ì—…" maxlength="50">
      </div>
      <div class="field">
        <label>ìµœì¢… ë§ˆê°ì¼</label>
        <input type="date" id="inp-date">
      </div>
    </div>

    <div class="sec">ì‘ì—… ìœ í˜•</div>
    <div class="type-row">
      <button class="tbtn on" data-type="webtoon" onclick="setType('webtoon')">ğŸ ì›¹íˆ°</button>
      <button class="tbtn" data-type="illust" onclick="setType('illust')">ğŸ¨ ì¼ëŸ¬ìŠ¤íŠ¸</button>
    </div>

    <div id="cuts-row" class="row2" style="margin-bottom:14px">
      <div class="field">
        <label>ì „ì²´ ì»· ìˆ˜</label>
        <input type="number" id="inp-cuts" placeholder="ì˜ˆ: 70" min="1" max="9999">
      </div>
    </div>

    <div class="adder">
      <div class="sec">ë‹¨ê³„ ì¶”ê°€</div>
      <div class="stage-chips" id="form-chips"></div>
      <div class="custom-input-row" id="form-custom-row">
        <input type="text" id="new-sname" placeholder="ë‹¨ê³„ ì´ë¦„ ì§ì ‘ ì…ë ¥" maxlength="20">
        <input type="date" id="new-sdate">
        <button class="btn-g" onclick="addFormStageCustom()">+ ì¶”ê°€</button>
      </div>
      <div class="hint" style="margin-top:6px">ğŸ“… ë‹¨ê³„ ë§ˆê°ì¼ì€ ì„ íƒì‚¬í•­ Â· ì¹© í´ë¦­ìœ¼ë¡œ ë‹¨ê³„ ì¶”ê°€, ì§ì ‘ ì…ë ¥ë„ ê°€ëŠ¥í•´ìš”</div>
      <div class="preview-list" id="form-stage-preview"></div>
    </div>

    <button class="btn-r" onclick="submitProject()">ì‘ì—… ë§Œë“¤ê¸°</button>
  </div>

  <div id="proj-list"></div>
</div>

<script>
// ================================================================
// ìœ í‹¸
// ================================================================
function uid() {
  return 's' + Date.now() + Math.random().toString(36).slice(2);
}
function todayStr() {
  return new Date().toISOString().slice(0, 10);
}
function getDDay(ds) {
  if (!ds) return null;
  var a = new Date(); a.setHours(0,0,0,0);
  var b = new Date(ds); b.setHours(0,0,0,0);
  return Math.ceil((b - a) / 86400000);
}
function fmtDDay(d) {
  if (d === null) return '';
  if (d < 0) return 'D+' + Math.abs(d);
  if (d === 0) return 'D-DAY';
  return 'D-' + d;
}
function ddayCls(d) {
  if (d === null || d > 7) return 'ok';
  if (d <= 3) return 'urg';
  return 'wrn';
}
function e(tag, cls, txt) {
  var el = document.createElement(tag);
  if (cls) el.className = cls;
  if (txt !== undefined) el.textContent = txt;
  return el;
}

// ================================================================
// ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
// ================================================================
function save() {
  try {
    localStorage.setItem('wp3', JSON.stringify(projects));
  } catch(err) {
    alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
  }
}
function load() {
  try {
    var raw = localStorage.getItem('wp3');
    return raw ? JSON.parse(raw) : [];
  } catch(err) {
    return [];
  }
}

// ================================================================
// ì „ì—­ ìƒíƒœ
// ================================================================
var projects = load();
var formStages = [];
var currentType = 'webtoon';

// ================================================================
// í¼ - íƒ€ì… ì„ íƒ
// ================================================================
var STAGE_CHIPS = {
  webtoon: ['ëŸ¬í”„','ì„ í™”','ë°‘ìƒ‰','ëª…ì•”','ë³´ì •'],
  illust:  ['ëŸ¬í”„','ì„ í™”','ë°‘ìƒ‰','ëª…ì•”','ë³´ì •'],
  custom:  ['ëŸ¬í”„','ì„ í™”','ë°‘ìƒ‰','ëª…ì•”','ë³´ì •']
};

function setType(type) {
  currentType = type;
  document.querySelectorAll('.tbtn').forEach(function(b) {
    b.classList.toggle('on', b.dataset.type === type);
  });
  document.getElementById('cuts-row').style.display = type === 'webtoon' ? '' : 'none';
  renderFormChips(type);
}

function renderFormChips(type) {
  var wrap = document.getElementById('form-chips');
  if (!wrap) return;
  wrap.innerHTML = '';
  var names = STAGE_CHIPS[type] || STAGE_CHIPS.custom;
  names.forEach(function(name) {
    var chip = document.createElement('button');
    chip.className = 'schip';
    chip.textContent = name;
    chip.onclick = function() { showChipDatePicker('form-date-popup', name, function(date) {
      formStages.push({ name: name, date: date });
      renderFormPreview();
    }); };
    wrap.appendChild(chip);
  });
  // ì§ì ‘ ì…ë ¥ ì¹©
  var customChip = document.createElement('button');
  customChip.className = 'schip custom-chip';
  customChip.textContent = 'âœï¸ ì§ì ‘ ì…ë ¥';
  customChip.onclick = function() {
    var row = document.getElementById('form-custom-row');
    row.classList.toggle('show');
    if (row.classList.contains('show')) document.getElementById('new-sname').focus();
  };
  wrap.appendChild(customChip);
  // ë‚ ì§œ íŒì—… ì»¨í…Œì´ë„ˆ (ì—†ìœ¼ë©´ ìƒì„±)
  if (!document.getElementById('form-date-popup')) {
    var pop = document.createElement('div');
    pop.id = 'form-date-popup';
    pop.className = 'date-popup';
    document.getElementById('form-chips').parentNode.appendChild(pop);
  }
}

// ì¹© í´ë¦­ í›„ ë‚ ì§œ ì„ íƒ íŒì—…
function showChipDatePicker(popId, stageName, onConfirm) {
  var pop = document.getElementById(popId);
  if (!pop) return;
  pop.innerHTML = '';
  pop.classList.add('show');
  var label = pop.appendChild(document.createElement('span'));
  label.className = 'popup-label';
  label.textContent = 'ã€Œ' + stageName + 'ã€ ë§ˆê°ì¼ ì„ íƒ';
  var dateInp = pop.appendChild(document.createElement('input'));
  dateInp.type = 'date';
  dateInp.className = 'popup-date';
  var okBtn = pop.appendChild(document.createElement('button'));
  okBtn.className = 'popup-ok';
  okBtn.textContent = 'ì¶”ê°€';
  okBtn.onclick = function() { pop.classList.remove('show'); onConfirm(dateInp.value); };
  var hint = pop.appendChild(document.createElement('div'));
  hint.className = 'popup-hint';
  hint.textContent = 'ğŸ“… ë‹¨ê³„ ë§ˆê°ì¼ì€ ì„ íƒì‚¬í•­ì´ì—ìš”';
}

function addFormStageCustom() {
  var nameEl = document.getElementById('new-sname');
  var dateEl = document.getElementById('new-sdate');
  var name = nameEl.value.trim().slice(0, 20);
  if (!name) { alert('ë‹¨ê³„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  formStages.push({ name: name, date: dateEl.value });
  nameEl.value = '';
  dateEl.value = '';
  renderFormPreview();
}

// ================================================================
// í¼ - ë‹¨ê³„ ì¶”ê°€/ì‚­ì œ
// ================================================================
document.addEventListener('DOMContentLoaded', function() {
  var sname = document.getElementById('new-sname');
  if (sname) sname.addEventListener('keydown', function(ev) {
    if (ev.key === 'Enter') addFormStageCustom();
  });
});

function removeFormStage(idx) {
  formStages.splice(idx, 1);
  renderFormPreview();
}

function renderFormPreview() {
  var wrap = document.getElementById('form-stage-preview');
  wrap.innerHTML = '';
  for (var i = 0; i < formStages.length; i++) {
    (function(s, idx) {
      var item = wrap.appendChild(e('div', 'preview-item'));
      var left = item.appendChild(e('div', 'preview-left'));
      left.appendChild(e('span', 'preview-name', s.name));
      if (s.date) left.appendChild(e('span', 'bdg-date', s.date));
      var del = item.appendChild(e('button', 'btn-x', 'Ã—'));
      del.onclick = function() { removeFormStage(idx); };
    })(formStages[i], i);
  }
}

// ================================================================
// í”„ë¡œì íŠ¸ ìƒì„±
// ================================================================
function submitProject() {
  var name  = document.getElementById('inp-name').value.trim().slice(0, 50);
  var date  = document.getElementById('inp-date').value;
  var type  = currentType;
  var cutsRaw = document.getElementById('inp-cuts').value;
  var cuts  = type === 'webtoon' ? parseInt(cutsRaw, 10) : null;

  if (!name)  { alert('ì‘ì—… ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (!date)  { alert('ë§ˆê°ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (type === 'webtoon' && (!cuts || cuts < 1)) { alert('ì „ì²´ ì»· ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  // ì§ì ‘ì…ë ¥ë€ì— í…ìŠ¤íŠ¸ê°€ ë‚¨ì•„ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ formStagesì— ì¶”ê°€
  var snameEl = document.getElementById('new-sname');
  if (snameEl && snameEl.value.trim()) {
    var leftover = snameEl.value.trim().slice(0, 20);
    var sdateEl = document.getElementById('new-sdate');
    formStages.push({ name: leftover, date: sdateEl ? sdateEl.value : '' });
    snameEl.value = '';
  }

  if (formStages.length === 0) { alert('ë‹¨ê³„ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì¶”ê°€í•´ì£¼ì„¸ìš”.'); return; }

  var stages = [];
  for (var i = 0; i < formStages.length; i++) {
    stages.push({
      id:   uid(),
      name: formStages[i].name,
      date: formStages[i].date,
      logs: [],
      done: false
    });
  }

  var proj = {
    id:        uid(),
    name:      name,
    date:      date,
    type:      type,
    totalCuts: cuts,
    stages:    stages,
    memo:      ''
  };

  projects.unshift(proj);
  save();

  // í¼ ì´ˆê¸°í™”
  document.getElementById('inp-name').value = '';
  document.getElementById('inp-date').value = '';
  document.getElementById('inp-cuts').value = '';
  formStages = [];
  renderFormPreview();
  renderAll();
}

// ================================================================
// ë¡œê·¸ ìˆ˜ì • / ì‚­ì œ
// ================================================================
function editLog(projId, stageId, logIdx) {
  var proj  = getProj(projId);  if (!proj)  return;
  var stage = getStage(proj, stageId); if (!stage) return;
  var log   = stage.logs[logIdx]; if (!log) return;
  var val = prompt('ì»· ìˆ˜ë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”', log.amount);
  if (val === null) return;
  var num = parseInt(val, 10);
  if (!num || num < 1) { alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  log.amount = num;
  log.note = 'ìˆ˜ì •ë¨';
  save();
  refreshCard(projId);
}

function deleteLog(projId, stageId, logIdx) {
  if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) return;
  var proj  = getProj(projId);  if (!proj)  return;
  var stage = getStage(proj, stageId); if (!stage) return;
  stage.logs.splice(logIdx, 1);
  save();
  refreshCard(projId);
}

// ================================================================
// ì „ì²´ ì»· ìˆ˜ ìˆ˜ì •
// ================================================================
function editTotalCuts(projId) {
  var proj = getProj(projId); if (!proj) return;
  var val = prompt('ì „ì²´ ì»· ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', proj.totalCuts);
  if (val === null) return;
  var num = parseInt(val, 10);
  if (!num || num < 1) { alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  proj.totalCuts = num;
  save();
  refreshCard(projId);
}

// ================================================================
// ë‹¨ê³„ ì‚­ì œ
// ================================================================
function deleteStage(projId, stageId) {
  if (!confirm('ì´ ë‹¨ê³„ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
  var proj = getProj(projId); if (!proj) return;
  var idx = -1;
  for (var i = 0; i < proj.stages.length; i++) {
    if (proj.stages[i].id === stageId) { idx = i; break; }
  }
  if (idx >= 0) { proj.stages.splice(idx, 1); save(); refreshCard(projId); }
}

// ================================================================
// í”„ë¡œì íŠ¸ ì‚­ì œ  â† í•µì‹¬: ì¸ë±ìŠ¤ ê¸°ë°˜ splice
// ================================================================
function deleteProject(projId) {
  if (!confirm('ì‘ì—…ì„ ì‚­ì œí• ê¹Œìš”?\nì‚­ì œí•œ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ì–´ìš”.')) return;

  // id ì¼ì¹˜í•˜ëŠ” í•­ëª©ì„ ì¸ë±ìŠ¤ë¡œ ì°¾ì•„ splice
  var targetIdx = -1;
  for (var i = 0; i < projects.length; i++) {
    if (projects[i].id === projId) {
      targetIdx = i;
      break;
    }
  }
  if (targetIdx >= 0) {
    projects.splice(targetIdx, 1);
    save();
    renderAll();
  }
}

// ================================================================
// ì›¹íˆ° - ì‘ì—…ëŸ‰ ê¸°ë¡
// ================================================================
function recordWork(projId, stageId) {
  var proj  = getProj(projId);  if (!proj)  return;
  var stage = getStage(proj, stageId); if (!stage) return;
  var inputEl = document.getElementById('wi-' + stageId);
  if (!inputEl) return;
  var val = parseInt(inputEl.value, 10);
  if (!val || val < 1) { alert('ì‘ì—…ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  stage.logs.push({ date: todayStr(), amount: val, note: 'ì‘ì—… ì™„ë£Œ' });
  inputEl.value = '';
  save();
  refreshCard(projId);
}

// ================================================================
// ì¼ëŸ¬ìŠ¤íŠ¸ - ì™„ë£Œ í† ê¸€
// ================================================================
function toggleDone(projId, stageId) {
  var proj  = getProj(projId);  if (!proj)  return;
  var stage = getStage(proj, stageId); if (!stage) return;
  stage.done = !stage.done;
  stage.logs.push({ date: todayStr(), amount: null, note: stage.done ? 'ì™„ë£Œ ì²˜ë¦¬' : 'ì™„ë£Œ ì·¨ì†Œ' });
  save();
  refreshCard(projId);
}

// ================================================================
// ì¹´ë“œ ë‚´ ë‹¨ê³„ ì¶”ê°€
// ================================================================
function addStageInCard(projId) {
  var proj = getProj(projId); if (!proj) return;
  var nameEl = document.getElementById('cn-' + projId);
  var dateEl = document.getElementById('cd-' + projId);
  if (!nameEl) return;
  var name = nameEl.value.trim().slice(0, 20);
  if (!name) { alert('ë‹¨ê³„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  proj.stages.push({ id: uid(), name: name, date: dateEl.value, logs: [], done: false });
  nameEl.value = '';
  if (dateEl) dateEl.value = '';
  save();
  refreshCard(projId);
}

function addStageInCardByName(projId, name, date) {
  var proj = getProj(projId); if (!proj) return;
  proj.stages.push({ id: uid(), name: name, date: date || '', logs: [], done: false });
  save();
  refreshCard(projId);
}

// ================================================================
// ë©”ëª¨ ì €ì¥
// ================================================================
function saveMemo(projId, val) {
  var proj = getProj(projId); if (!proj) return;
  proj.memo = val.slice(0, 300);
  save();
}

// ================================================================
// í—¬í¼: proj/stage ì¡°íšŒ
// ================================================================
function getProj(projId) {
  for (var i = 0; i < projects.length; i++) {
    if (projects[i].id === projId) return projects[i];
  }
  return null;
}
function getStage(proj, stageId) {
  for (var i = 0; i < proj.stages.length; i++) {
    if (proj.stages[i].id === stageId) return proj.stages[i];
  }
  return null;
}

// ================================================================
// ì¹´ë“œ í† ê¸€
// ================================================================
function toggleCard(projId) {
  var card = document.getElementById('card-' + projId);
  if (card) card.classList.toggle('open');
}

// ================================================================
// ì¹´ë“œ ìƒˆë¡œê³ ì¹¨
// ================================================================
function refreshCard(projId) {
  var proj = getProj(projId); if (!proj) return;
  var old = document.getElementById('card-' + projId); if (!old) return;
  var wasOpen = old.classList.contains('open');
  // ì ‘í˜€ìˆë˜ ë‹¨ê³„ë“¤ ê¸°ì–µ
  var collapsed = {};
  old.querySelectorAll('.sblock').forEach(function(blk) {
    if (blk.dataset.stageId && blk.classList.contains('sblock-collapsed')) {
      collapsed[blk.dataset.stageId] = true;
    }
  });
  var newCard = buildCard(proj, collapsed);
  if (wasOpen) newCard.classList.add('open');
  old.parentNode.replaceChild(newCard, old);
}

// ================================================================
// ì¹´ë“œ ë¹Œë“œ
// ================================================================
function buildCard(proj, collapsed) {
  collapsed = collapsed || {};
  var isW    = proj.type === 'webtoon';
  var stages = proj.stages;
  var dday   = getDDay(proj.date);

  // â”€â”€ ì§„í–‰ë¥  ê³„ì‚°
  var avgPct = 0, stageDone = 0, stageTotal = stages.length;
  if (stageTotal > 0) {
    if (isW) {
      var totalCuts = proj.totalCuts || 1;
      var sum = 0;
      for (var i = 0; i < stages.length; i++) {
        var cut = 0;
        for (var j = 0; j < stages[i].logs.length; j++) {
          cut += stages[i].logs[j].amount || 0;
        }
        var sp = Math.min(100, Math.round(cut / totalCuts * 100));
        sum += sp;
        if (sp >= 100) stageDone++;
      }
      avgPct = Math.round(sum / stageTotal);
    } else {
      for (var i = 0; i < stages.length; i++) {
        if (stages[i].done) stageDone++;
      }
      avgPct = Math.round(stageDone / stageTotal * 100);
    }
  }
  var stagePct = stageTotal ? Math.round(stageDone / stageTotal * 100) : 0;
  var allDone  = stageTotal > 0 && stageDone === stageTotal;

  // â”€â”€ ì¹´ë“œ ë£¨íŠ¸
  var card = e('div', 'pcard');
  card.id = 'card-' + proj.id;

  // â”€â”€ í—¤ë”
  var head = card.appendChild(e('div', 'phead'));
  // í—¤ë” í´ë¦­ - ì‚­ì œ ë²„íŠ¼ ìœ„ì—ì„œ í´ë¦­ ì‹œ ì œì™¸
  head.addEventListener('click', (function(pid) {
    return function(ev) {
      if (!ev.target.closest('.del-btn')) toggleCard(pid);
    };
  })(proj.id));

  var titleDiv = head.appendChild(e('div', 'ptitle'));
  titleDiv.appendChild(e('span', 'pname', proj.name));
  var bc = allDone ? 'dn' : ddayCls(dday);
  var bt = allDone ? 'âœ… ì™„ì„±' : fmtDDay(dday);
  titleDiv.appendChild(e('span', 'dday ' + bc, bt));

  var pright = head.appendChild(e('div', 'pright'));

  // ì‚­ì œ ë²„íŠ¼ - í´ë¡œì €ë¡œ projId ìº¡ì²˜
  var delBtn = pright.appendChild(e('button', 'del-btn', 'Ã—'));
  delBtn.title = 'ì‘ì—… ì‚­ì œ';
  delBtn.addEventListener('click', (function(pid) {
    return function(ev) {
      ev.stopPropagation();
      deleteProject(pid);
    };
  })(proj.id));

  pright.insertAdjacentHTML('beforeend',
    '<svg class="chv" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');

  // â”€â”€ ë°”ë””
  var body = card.appendChild(e('div', 'pbody'));

  // ì´ì¤‘ ì§„í–‰ë¥  ë°”
  var dp = body.appendChild(e('div', 'dp'));

  var r1 = dp.appendChild(e('div', 'prog-row'));
  var r1t = r1.appendChild(e('div', 'prog-top'));
  r1t.appendChild(e('span', 'prog-label', isW ? 'í‰ê·  ì§„í–‰ë¥ ' : 'ì „ì²´ ì§„í–‰ë¥ '));
  r1t.appendChild(e('span', 'prog-val', avgPct + '%'));
  var r1b = r1.appendChild(e('div', 'bar'));
  var r1f = r1b.appendChild(e('div', 'bar-fill-g'));
  r1f.style.width = avgPct + '%';

  var r2 = dp.appendChild(e('div', 'prog-row'));
  var r2t = r2.appendChild(e('div', 'prog-top'));
  r2t.appendChild(e('span', 'prog-label', 'ë‹¨ê³„ ì™„ë£Œ'));
  r2t.appendChild(e('span', 'prog-val', stageDone + ' / ' + stageTotal));
  var r2b = r2.appendChild(e('div', 'bar'));
  var r2f = r2b.appendChild(e('div', 'bar-fill-b'));
  r2f.style.width = stagePct + '%';

  var subRow = dp.appendChild(e('div', 'prog-sub'));
  if (isW) {
    subRow.textContent = 'ë§ˆê° ' + proj.date + ' Â· ì „ì²´ ' + proj.totalCuts + 'ì»·';
    var editCutsBtn = subRow.appendChild(e('button', 'edit-cuts-btn', 'âœï¸ ìˆ˜ì •'));
    editCutsBtn.addEventListener('click', (function(pid) {
      return function() { editTotalCuts(pid); };
    })(proj.id));
  } else {
    subRow.textContent = 'ë§ˆê° ' + proj.date;
  }

  // â”€â”€ ë‹¨ê³„ ëª©ë¡
  var sw = body.appendChild(e('div'));
  sw.appendChild(e('div', 'sec', 'ë‹¨ê³„ë³„ ì§„ë„'));
  var slist = sw.appendChild(e('div', 'slist'));

  for (var si = 0; si < stages.length; si++) {
    (function(stage) {
      var sd   = stage.date ? getDDay(stage.date) : null;
      var cuts = 0;
      for (var li = 0; li < stage.logs.length; li++) {
        cuts += stage.logs[li].amount || 0;
      }
      var spct = isW ? Math.min(100, Math.round(cuts / (proj.totalCuts || 1) * 100)) : (stage.done ? 100 : 0);
      var isDone = isW ? spct >= 100 : stage.done;

      var blk = slist.appendChild(e('div', 'sblock' + (isDone ? ' ok-block' : '') + (collapsed[stage.id] ? ' sblock-collapsed' : '')));
      blk.dataset.stageId = stage.id;

      // ë¸”ë¡ í—¤ë” (í† ê¸€ í¬í•¨)
      var sh = blk.appendChild(e('div', 'shead'));
      sh.style.cursor = 'pointer';
      sh.addEventListener('click', function(ev) {
        if (!ev.target.closest('.sdel-btn')) {
          blk.classList.toggle('sblock-collapsed');
        }
      });
      var sl = sh.appendChild(e('div', 'shead-left'));
      sl.appendChild(e('span', 'sname', stage.name));
      if (stage.date) {
        var sdTxt = isDone ? 'ì™„ë£Œ âœ“' : (stage.date + ' ' + fmtDDay(sd));
        sl.appendChild(e('span', 'sdday ' + (isDone ? 'ok' : ddayCls(sd)), sdTxt));
      }
      var sheadRight = sh.appendChild(e('div', 'sblock-head-wrap'));
      sheadRight.appendChild(e('span', 'spct', spct + '%'));
      var delSBtn = sheadRight.appendChild(e('button', 'sdel-btn', 'ğŸ—‘'));
      delSBtn.title = 'ë‹¨ê³„ ì‚­ì œ';
      delSBtn.addEventListener('click', (function(pid, sid) {
        return function(ev) {
          ev.stopPropagation();
          deleteStage(pid, sid);
        };
      })(proj.id, stage.id));

      // ë¸”ë¡ ë°”ë””
      var sb = blk.appendChild(e('div', 'sbody'));

      if (isW) {
        // ë‹¨ê³„ ì§„í–‰ ë°”
        var sbr = sb.appendChild(e('div', 'sbar-row'));
        var sbt = sbr.appendChild(e('div', 'sbar-top'));
        sbt.appendChild(e('span', 'sbar-txt', cuts + 'ì»· ì™„ë£Œ'));
        sbt.appendChild(e('span', 'sbar-txt', '/ ' + (proj.totalCuts || '?') + 'ì»·'));
        var bt2 = sbr.appendChild(e('div', 'bar'));
        var bf2 = bt2.appendChild(e('div', 'bar-fill-g'));
        bf2.style.width = spct + '%';

        // ì˜¤ëŠ˜ ì‘ì—…ëŸ‰ ì…ë ¥
        var wr = sb.appendChild(e('div', 'winrow'));
        var ww = wr.appendChild(e('div', 'winwrap'));
        var wi = document.createElement('input');
        wi.type = 'number'; wi.min = 1; wi.max = 9999;
        wi.placeholder = 'ì˜¤ëŠ˜ ì‘ì—…í•œ ì»· ìˆ˜';
        wi.id = 'wi-' + stage.id;
        ww.appendChild(wi);
        ww.appendChild(e('span', 'wunit', 'ì»·'));
        wi.addEventListener('keydown', (function(pid, sid) {
          return function(ev) { if (ev.key === 'Enter') recordWork(pid, sid); };
        })(proj.id, stage.id));
        var rb = wr.appendChild(e('button', 'btn-rec', 'ê¸°ë¡'));
        rb.addEventListener('click', (function(pid, sid) {
          return function() { recordWork(pid, sid); };
        })(proj.id, stage.id));

      } else {
        // ì¼ëŸ¬ìŠ¤íŠ¸: ì²´í¬ë°•ìŠ¤
        var cbr = sb.appendChild(e('div', 'cbrow' + (stage.done ? ' done' : '')));
        var cb  = cbr.appendChild(e('div', 'cb' + (stage.done ? ' on' : '')));
        cb.innerHTML = '<svg width="11" height="11" viewBox="0 0 11 11" fill="none"><polyline points="1.5,5.5 4,8 9.5,2.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        cbr.appendChild(e('span', 'cblabel', stage.done ? 'ì™„ë£Œë¨' : 'ì™„ë£Œ í‘œì‹œ'));
        cbr.addEventListener('click', (function(pid, sid) {
          return function() { toggleDone(pid, sid); };
        })(proj.id, stage.id));
      }

      // ë¡œê·¸
      if (stage.logs.length > 0) {
        sb.appendChild(e('div', 'sec', 'ë¡œê·¸'));
        var ll = sb.appendChild(e('div', 'loglist'));
        var reversed = stage.logs.slice().reverse();
        // reversed[i]ì˜ ì›ë³¸ ì¸ë±ìŠ¤ = logs.length - 1 - i
        for (var li = 0; li < reversed.length; li++) {
          var lg = reversed[li];
          var origIdx = stage.logs.length - 1 - li;
          var li2 = ll.appendChild(e('div', 'logitem'));
          li2.appendChild(e('span', 'ldate', lg.date));
          li2.appendChild(e('span', 'lamt', lg.amount !== null ? '+' + lg.amount + 'ì»·' : 'â€”'));
          li2.appendChild(e('span', 'lnote', lg.note));
          // ì›¹íˆ° ì»· ë¡œê·¸ë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
          if (lg.amount !== null) {
            var logBtns = li2.appendChild(e('div', 'log-btns'));
            var editLogBtn = logBtns.appendChild(e('button', 'log-edit-btn', 'ìˆ˜ì •'));
            editLogBtn.addEventListener('click', (function(pid, sid, idx) {
              return function() { editLog(pid, sid, idx); };
            })(proj.id, stage.id, origIdx));
            var delLogBtn = logBtns.appendChild(e('button', 'log-del-btn', 'ì‚­ì œ'));
            delLogBtn.addEventListener('click', (function(pid, sid, idx) {
              return function() { deleteLog(pid, sid, idx); };
            })(proj.id, stage.id, origIdx));
          }
        }
      }
    })(stages[si]);
  }

  // â”€â”€ ì¹´ë“œ ë‚´ ë‹¨ê³„ ì¶”ê°€ (ì¹© UI)
  var aw = body.appendChild(e('div'));
  aw.appendChild(e('div', 'sec', 'ë‹¨ê³„ ì¶”ê°€'));
  var ia = aw.appendChild(e('div', 'inline-adder'));

  // ì¹© í–‰
  var chipRow = ia.appendChild(e('div', 'stage-chips'));
  var chipNames = STAGE_CHIPS[proj.type] || STAGE_CHIPS.custom;
  var cardPopId = 'card-date-popup-' + proj.id;
  chipNames.forEach(function(cname) {
    var chip = chipRow.appendChild(e('button', 'schip', cname));
    chip.addEventListener('click', (function(pid, n, popId) {
      return function() {
        showChipDatePicker(popId, n, function(date) {
          addStageInCardByName(pid, n, date);
        });
      };
    })(proj.id, cname, cardPopId));
  });
  // ì§ì ‘ ì…ë ¥ ì¹©
  var customChipCard = chipRow.appendChild(e('button', 'schip custom-chip', 'âœï¸ ì§ì ‘ ì…ë ¥'));
  customChipCard.addEventListener('click', function() {
    var row = document.getElementById('ic-row-' + proj.id);
    if (row) row.classList.toggle('show');
    var inp = document.getElementById('cn-' + proj.id);
    if (inp && document.getElementById('ic-row-' + proj.id).classList.contains('show')) inp.focus();
  });
  // íŒì—… ì»¨í…Œì´ë„ˆ
  var cardPop = ia.appendChild(e('div', 'date-popup'));
  cardPop.id = cardPopId;

  // ì§ì ‘ ì…ë ¥ í–‰ (ìˆ¨ê¹€)
  var iar = ia.appendChild(e('div', 'custom-input-row'));
  iar.id = 'ic-row-' + proj.id;

  var cnInp = document.createElement('input');
  cnInp.type = 'text'; cnInp.placeholder = 'ë‹¨ê³„ ì´ë¦„ ì§ì ‘ ì…ë ¥'; cnInp.maxLength = 20;
  cnInp.id = 'cn-' + proj.id;
  iar.appendChild(cnInp);

  var cdInp = document.createElement('input');
  cdInp.type = 'date';
  cdInp.id = 'cd-' + proj.id;
  iar.appendChild(cdInp);

  var caBtn = iar.appendChild(e('button', 'btn-g', '+ ì¶”ê°€'));
  caBtn.addEventListener('click', (function(pid) {
    return function() { addStageInCard(pid); };
  })(proj.id));
  cnInp.addEventListener('keydown', (function(pid) {
    return function(ev) { if (ev.key === 'Enter') addStageInCard(pid); };
  })(proj.id));
  ia.appendChild(e('div', 'hint', 'ğŸ“… ë‹¨ê³„ ë§ˆê°ì¼ì€ ì§ì ‘ ì…ë ¥ ì‹œ ì„ íƒì‚¬í•­'));

  // â”€â”€ ë©”ëª¨
  var mw = body.appendChild(e('div'));
  mw.appendChild(e('div', 'sec', 'ë©”ëª¨'));
  var mt = mw.appendChild(document.createElement('textarea'));
  mt.className = 'memo'; mt.placeholder = 'í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì‚¬í•­, ì°¸ê³ ì‚¬í•­ ë“±...';
  mt.maxLength = 300; mt.value = proj.memo || '';
  mt.addEventListener('input', (function(pid) {
    return function() { saveMemo(pid, mt.value); };
  })(proj.id));

  return card;
}

// ================================================================
// ì „ì²´ ë Œë”
// ================================================================
function renderAll() {
  var container = document.getElementById('proj-list');
  container.innerHTML = '';
  if (projects.length === 0) {
    container.innerHTML = '<div class="empty"><p>ğŸ¨</p><p>ì•„ì§ ì‘ì—…ì´ ì—†ì–´ìš”.<br>ìœ„ì—ì„œ ì¶”ê°€í•´ë³´ì„¸ìš”!</p></div>';
    return;
  }
  for (var i = 0; i < projects.length; i++) {
    container.appendChild(buildCard(projects[i]));
  }
}

// ================================================================
// ì´ˆê¸°í™”
// ================================================================
setType('webtoon');
renderAll();
</script>
</body>
</html>
