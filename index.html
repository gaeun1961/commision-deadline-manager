<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì»¤ë¯¸ì…˜ ë§ˆê° ì‹œë®¬ë ˆì´í„°</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0e12;
    --surface: #16161e;
    --surface2: #1e1e2a;
    --border: #2a2a3a;
    --accent: #ff6b6b;
    --accent2: #ffd93d;
    --accent3: #6bcb77;
    --text: #e8e8f0;
    --text2: #8888aa;
    --text3: #555570;
    --radius: 12px;
    --transition: 0.2s ease;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    padding: 24px 16px 80px;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  header {
    max-width: 780px;
    margin: 0 auto 32px;
    display: flex;
    align-items: baseline;
    gap: 12px;
  }

  header h1 { font-size: 22px; font-weight: 900; letter-spacing: -0.5px; }
  header h1 span { color: var(--accent); }
  header p { font-size: 12px; color: var(--text3); font-family: 'Space Mono', monospace; }

  .main {
    max-width: 780px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .add-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
  }

  .add-card h2 {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--accent);
    margin-bottom: 20px;
  }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
  .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
  .field { display: flex; flex-direction: column; gap: 6px; }
  .field label { font-size: 11px; color: var(--text2); font-weight: 500; letter-spacing: 0.5px; }

  .field input[type="text"],
  .field input[type="number"],
  .field input[type="date"] {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color var(--transition);
    width: 100%;
  }

  .field input:focus { border-color: var(--accent); }
  .field input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.5); cursor: pointer; }

  .unit-toggle { display: flex; gap: 8px; }

  .unit-btn {
    flex: 1; padding: 10px;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--text2);
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px; font-weight: 600;
    font-family: 'Noto Sans KR', sans-serif;
    transition: all var(--transition);
    text-align: center;
  }

  .unit-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

  .add-btn {
    width: 100%; margin-top: 4px; padding: 12px;
    background: var(--accent); color: white;
    border: none; border-radius: 8px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px; font-weight: 700;
    cursor: pointer; transition: all var(--transition);
  }

  .add-btn:hover { background: #ff4f4f; transform: translateY(-1px); }

  .project-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .project-header {
    padding: 18px 24px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
    cursor: pointer; user-select: none;
  }

  .project-header:hover { background: var(--surface2); }

  .project-title-row { display: flex; align-items: center; gap: 12px; }
  .project-name { font-size: 15px; font-weight: 700; }

  .tag {
    font-size: 10px; padding: 3px 8px;
    border-radius: 20px; font-weight: 600;
    font-family: 'Space Mono', monospace;
  }

  .tag.comic   { background: rgba(107,203,119,0.2); color: var(--accent3); }
  .tag.illust  { background: rgba(255,217,61,0.2);  color: var(--accent2); }

  .dday-badge {
    font-family: 'Space Mono', monospace;
    font-size: 12px; font-weight: 700;
    padding: 4px 10px; border-radius: 6px;
  }

  .dday-badge.urgent  { background: rgba(255,107,107,0.2); color: var(--accent); }
  .dday-badge.ok      { background: rgba(107,203,119,0.15); color: var(--accent3); }
  .dday-badge.warning { background: rgba(255,217,61,0.15);  color: var(--accent2); }

  .chevron { width: 16px; height: 16px; color: var(--text3); transition: transform 0.3s ease; }
  .project-card.open .chevron { transform: rotate(180deg); }

  .project-body { display: none; padding: 24px; flex-direction: column; gap: 24px; }
  .project-card.open .project-body { display: flex; }

  .guide-banner {
    background: rgba(255,217,61,0.08);
    border: 1px solid rgba(255,217,61,0.2);
    border-radius: 8px; padding: 12px 16px;
    font-size: 13px; color: var(--accent2);
    text-align: center; font-weight: 500;
  }

  .pace-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }

  .pace-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px; padding: 16px; text-align: center;
  }

  .pace-card.highlight { border-color: var(--accent3); background: rgba(107,203,119,0.05); }

  .pace-label {
    font-size: 10px; font-weight: 700;
    letter-spacing: 1px; color: var(--text3);
    text-transform: uppercase; margin-bottom: 8px;
  }

  .pace-card.highlight .pace-label { color: var(--accent3); }

  .pace-value {
    font-size: 28px; font-weight: 900;
    font-family: 'Space Mono', monospace;
    line-height: 1; margin-bottom: 4px;
  }

  .pace-unit { font-size: 11px; color: var(--text3); }

  .progress-section { display: flex; flex-direction: column; gap: 10px; }
  .progress-label-row { display: flex; justify-content: space-between; align-items: baseline; }
  .progress-label { font-size: 11px; color: var(--text2); font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }
  .progress-pct { font-family: 'Space Mono', monospace; font-size: 20px; font-weight: 700; }

  .progress-bar-track {
    height: 10px; background: var(--surface2);
    border-radius: 20px; overflow: hidden; border: 1px solid var(--border);
  }

  .progress-bar-fill {
    height: 100%; border-radius: 20px;
    background: linear-gradient(90deg, var(--accent3), #4dc957);
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .progress-sub { font-size: 12px; color: var(--text3); font-family: 'Space Mono', monospace; }

  .section-title {
    font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 1.5px;
    color: var(--text2); margin-bottom: 12px;
  }

  .today-row { display: flex; gap: 8px; align-items: stretch; }
  .today-input-wrap { flex: 1; position: relative; display: flex; align-items: center; }

  .today-input-wrap input {
    width: 100%; background: var(--surface2);
    border: 1px solid var(--border); border-radius: 8px;
    padding: 10px 40px 10px 14px; color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 16px; font-weight: 700;
    outline: none; transition: border-color var(--transition);
  }

  .today-input-wrap input:focus { border-color: var(--accent); }
  .today-unit { position: absolute; right: 12px; font-size: 12px; color: var(--text3); }

  .today-add-btn {
    padding: 10px 16px; background: var(--accent); color: white;
    border: none; border-radius: 8px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px; font-weight: 700;
    cursor: pointer; transition: all var(--transition); white-space: nowrap;
  }

  .today-add-btn:hover { background: #ff4f4f; }

  .rest-btn {
    padding: 10px 16px; background: transparent; color: var(--text2);
    border: 1px solid var(--border); border-radius: 8px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all var(--transition); white-space: nowrap;
  }

  .rest-btn:hover { border-color: var(--accent2); color: var(--accent2); }

  .log-list { display: flex; flex-direction: column; gap: 6px; max-height: 200px; overflow-y: auto; }
  .log-list::-webkit-scrollbar { width: 4px; }
  .log-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .log-item {
    display: flex; align-items: center; gap: 12px;
    padding: 10px 14px;
    background: var(--surface2); border-radius: 8px; border: 1px solid var(--border);
  }

  .log-item.rest-log { border-color: rgba(255,217,61,0.2); }

  .log-date   { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--text3); min-width: 80px; }
  .log-amount { font-family: 'Space Mono', monospace; font-weight: 700; color: var(--accent3); min-width: 60px; }
  .log-item.rest-log .log-amount { color: var(--accent2); }
  .log-note   { color: var(--text2); font-size: 12px; }
  .log-empty  { font-size: 12px; color: var(--text3); text-align: center; padding: 20px; font-family: 'Space Mono', monospace; }

  .header-right { display: flex; align-items: center; gap: 8px; }

  .delete-btn {
    background: none; border: none; color: var(--text3);
    cursor: pointer; font-size: 18px;
    padding: 4px 8px; border-radius: 6px;
    transition: all var(--transition); line-height: 1;
  }

  .delete-btn:hover { background: rgba(255,107,107,0.1); color: var(--accent); }

  .empty-state {
    text-align: center; padding: 48px 24px;
    color: var(--text3); font-size: 13px;
    font-family: 'Space Mono', monospace;
    background: var(--surface);
    border: 1px dashed var(--border);
    border-radius: var(--radius);
  }

  .empty-state p:first-child { font-size: 32px; margin-bottom: 12px; }

  @media (max-width: 520px) {
    .form-row { grid-template-columns: 1fr; }
    .form-row.three { grid-template-columns: 1fr 1fr; }
    .pace-grid { grid-template-columns: 1fr; }
    .today-row { flex-wrap: wrap; }
  }
</style>
</head>
<body>

<header>
  <h1>ì»¤ë¯¸ì…˜ <span>ë§ˆê°</span> ì‹œë®¬ë ˆì´í„°</h1>
  <p>// deadline manager</p>
</header>

<div class="main">
  <div class="add-card">
    <h2>+ ìƒˆ ì»¤ë¯¸ì…˜ ì¶”ê°€</h2>
    <div class="form-row">
      <div class="field">
        <label>ì»¤ë¯¸ì…˜/í”„ë¡œì íŠ¸ ì´ë¦„</label>
        <input type="text" id="inp-name" placeholder="ì˜ˆ: OOë‹˜ ì»¤ë¯¸ì…˜" maxlength="50">
      </div>
      <div class="field">
        <label>ë§ˆê° ë‚ ì§œ</label>
        <input type="date" id="inp-date">
      </div>
    </div>
    <div class="form-row three">
      <div class="field" style="grid-column: span 2;">
        <label>ì´ ì‘ì—…ëŸ‰</label>
        <input type="number" id="inp-total" placeholder="0" min="1" max="9999">
      </div>
      <div class="field">
        <label>ë‹¨ìœ„</label>
        <div class="unit-toggle">
          <button class="unit-btn active" id="btn-comic" onclick="setUnit('ì»·')">ì»· (ë§Œí™”)</button>
          <button class="unit-btn" id="btn-illust" onclick="setUnit('ì¥')">ì¥ (ì¼ëŸ¬)</button>
        </div>
      </div>
    </div>
    <button class="add-btn" onclick="addProject()">ì»¤ë¯¸ì…˜ ì¶”ê°€í•˜ê¸°</button>
  </div>

  <div id="projects-container"></div>
</div>

<script>
  const today = () => new Date().toISOString().slice(0, 10);

  function getDDay(dateStr) {
    const now = new Date(); now.setHours(0,0,0,0);
    const end = new Date(dateStr); end.setHours(0,0,0,0);
    return Math.ceil((end - now) / 86400000);
  }

  function save() {
    try {
      localStorage.setItem('commission_projects', JSON.stringify(projects));
    } catch {
      alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì˜¤ë˜ëœ ì»¤ë¯¸ì…˜ì„ ì‚­ì œí•´ë³´ì„¸ìš”.');
    }
  }

  // XSS ë°©ì§€ í•µì‹¬ í—¬í¼ - ì‚¬ìš©ì ì…ë ¥ê°’ì€ ë¬´ì¡°ê±´ ì´ê±¸ë¡œ ì²˜ë¦¬
  function el(tag, props = {}, text = '') {
    const e = document.createElement(tag);
    Object.assign(e, props);
    if (text) e.textContent = text;
    return e;
  }

  let selectedUnit = 'ì»·';
  let projects = JSON.parse(localStorage.getItem('commission_projects') || '[]');

  const getTotalDone = proj => proj.logs.filter(l => !l.rest).reduce((s, l) => s + l.amount, 0);

  function setUnit(unit) {
    selectedUnit = unit;
    document.getElementById('btn-comic').classList.toggle('active', unit === 'ì»·');
    document.getElementById('btn-illust').classList.toggle('active', unit === 'ì¥');
  }

  function addProject() {
    const name  = document.getElementById('inp-name').value.trim().slice(0, 50);
    const date  = document.getElementById('inp-date').value;
    const total = parseInt(document.getElementById('inp-total').value);

    if (!name)               return alert('í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    if (!date)               return alert('ë§ˆê° ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    if (!total || total < 1) return alert('ì´ ì‘ì—…ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    if (getDDay(date) < 0)   return alert('ë§ˆê°ì¼ì´ ì´ë¯¸ ì§€ë‚¬ì–´ìš”!');

    projects.unshift({
      id: Date.now(), name, date, total,
      unit: selectedUnit,
      type: selectedUnit === 'ì»·' ? 'comic' : 'illust',
      logs: []
    });
    save(); renderProjects();
    ['inp-name','inp-date','inp-total'].forEach(id => document.getElementById(id).value = '');
  }

  function deleteProject(id) {
    if (!confirm('ì´ ì»¤ë¯¸ì…˜ì„ ì‚­ì œí• ê¹Œìš”?')) return;
    projects = projects.filter(p => p.id !== id);
    save(); renderProjects();
  }

  function addWork(id) {
    const input = document.getElementById(`work-input-${id}`);
    const val   = parseInt(input.value);
    if (!val || val < 1) return alert('ì‘ì—…ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    const proj = projects.find(p => p.id === id);
    proj.logs.unshift({ date: today(), amount: val, rest: false });
    input.value = '';
    save(); renderProject(proj);
  }

  function addRest(id) {
    const proj = projects.find(p => p.id === id);
    if (proj.logs.some(l => l.date === today() && l.rest))
      return alert('ì˜¤ëŠ˜ì€ ì´ë¯¸ íœ´ì‹ìœ¼ë¡œ ê¸°ë¡í–ˆì–´ìš”!');
    proj.logs.unshift({ date: today(), amount: 0, rest: true });
    save(); renderProject(proj);
  }

  function toggleCard(id) {
    document.getElementById(`card-${id}`).classList.toggle('open');
  }

  function renderProject(proj) {
    const dday      = getDDay(proj.date);
    const done      = getTotalDone(proj);
    const remaining = Math.max(0, proj.total - done);
    const pct       = Math.min(100, Math.round(done / proj.total * 100));
    const days      = Math.max(1, dday);
    const { unit }  = proj;

    const minPace     = Math.ceil(remaining / days);
    const comfortPace = Math.ceil(remaining / Math.max(1, days * 0.85));
    const easyPace    = Math.ceil(remaining / Math.max(1, days * 0.7));

    const ddayText  = dday < 0 ? `D+${Math.abs(dday)}` : dday === 0 ? 'D-DAY' : `D-${dday}`;
    const ddayClass = dday <= 3 ? 'urgent' : dday <= 7 ? 'warning' : 'ok';

    const existing = document.getElementById(`card-${proj.id}`);
    const isOpen   = existing?.classList.contains('open');

    const card = el('div', { className: `project-card${isOpen ? ' open' : ''}`, id: `card-${proj.id}` });

    const header = card.appendChild(el('div', { className: 'project-header' }));
    header.onclick = () => toggleCard(proj.id);

    const titleRow = header.appendChild(el('div', { className: 'project-title-row' }));
    titleRow.appendChild(el('span', { className: 'project-name' }, proj.name));
    titleRow.appendChild(el('span', { className: `tag ${proj.type}` }, unit === 'ì»·' ? 'ë§Œí™”' : 'ì¼ëŸ¬ìŠ¤íŠ¸'));

    const right = header.appendChild(el('div', { className: 'header-right' }));
    right.appendChild(el('div', { className: `dday-badge ${ddayClass}` }, ddayText));

    const delBtn = right.appendChild(el('button', { className: 'delete-btn' }, 'Ã—'));
    delBtn.onclick = e => { e.stopPropagation(); deleteProject(proj.id); };

    right.insertAdjacentHTML('beforeend', `
      <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"/>
      </svg>`);

    const body = card.appendChild(el('div', { className: 'project-body' }));

    body.insertAdjacentHTML('beforeend', `
      <div class="guide-banner">
        ì•ˆì‹¬ êµ¬ê°„ì— ì§„ì…í•˜ë ¤ë©´ ì˜¤ëŠ˜ <strong>${comfortPace}${unit}</strong> ì´ìƒ ì‘ì—…í•´ì•¼ í•´ìš”!
      </div>
      <div class="pace-grid">
        <div class="pace-card">
          <div class="pace-label">ìµœì†Œ</div>
          <div class="pace-value">${minPace}</div>
          <div class="pace-unit">${unit} / ì¼ Â· ë§¤ì¼ ì‘ì—… ê¸°ì¤€</div>
        </div>
        <div class="pace-card highlight">
          <div class="pace-label">ì•ˆì‹¬ âœ¦</div>
          <div class="pace-value">${comfortPace}</div>
          <div class="pace-unit">${unit} / ì¼ Â· 15% ì—¬ìœ  í™•ë³´</div>
        </div>
        <div class="pace-card">
          <div class="pace-label">ì—¬ìœ </div>
          <div class="pace-value">${easyPace}</div>
          <div class="pace-unit">${unit} / ì¼ Â· 30% ì—¬ìœ  í™•ë³´</div>
        </div>
      </div>
      <div class="progress-section">
        <div class="progress-label-row">
          <span class="progress-label">ì „ì²´ ì™„ë£Œìœ¨</span>
          <span class="progress-pct">${pct}%</span>
        </div>
        <div class="progress-bar-track">
          <div class="progress-bar-fill" style="width:${pct}%"></div>
        </div>
        <div class="progress-sub">${done} / ${proj.total} ${unit} ì™„ë£Œ Â· ë‚¨ì€ ì‘ì—…ëŸ‰ ${remaining}${unit}</div>
      </div>
      <div>
        <div class="section-title">ì˜¤ëŠ˜ ì‘ì—…ëŸ‰ ì…ë ¥</div>
        <div class="today-row">
          <div class="today-input-wrap">
            <input type="number" id="work-input-${proj.id}" placeholder="0" min="1" max="9999">
            <span class="today-unit">${unit}</span>
          </div>
          <button class="today-add-btn" onclick="addWork(${proj.id})">ê¸°ë¡í•˜ê¸°</button>
          <button class="rest-btn" onclick="addRest(${proj.id})">ğŸ’¤ íœ´ì‹í–ˆì–´ìš”</button>
        </div>
      </div>`);

    body.querySelector(`#work-input-${proj.id}`)
        .addEventListener('keydown', e => { if (e.key === 'Enter') addWork(proj.id); });

    const logSection = body.appendChild(el('div'));
    logSection.appendChild(el('div', { className: 'section-title' }, 'ì‘ì—… ë¡œê·¸'));
    const logList = logSection.appendChild(el('div', { className: 'log-list' }));

    if (!proj.logs.length) {
      logList.innerHTML = `<div class="log-empty">// ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”</div>`;
    } else {
      proj.logs.forEach(l => {
        const item = logList.appendChild(el('div', { className: `log-item${l.rest ? ' rest-log' : ''}` }));
        item.appendChild(el('span', { className: 'log-date' },   l.date));
        item.appendChild(el('span', { className: 'log-amount' }, l.rest ? 'ğŸ’¤ íœ´ì‹' : `+${l.amount}${unit}`));
        item.appendChild(el('span', { className: 'log-note' },   l.rest ? 'ì˜¤ëŠ˜ì€ ì‰¬ì—ˆì–´ìš”' : 'ì‘ì—… ì™„ë£Œ'));
      });
    }

    existing ? existing.replaceWith(card) : null;
    return card;
  }

  function renderProjects() {
    const container = document.getElementById('projects-container');
    container.innerHTML = '';

    if (!projects.length) {
      container.innerHTML = `
        <div class="empty-state">
          <p>ğŸ¨</p>
          <p>ì•„ì§ ì»¤ë¯¸ì…˜ì´ ì—†ì–´ìš”.<br>ìœ„ì—ì„œ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
        </div>`;
      return;
    }

    projects.forEach(p => container.appendChild(renderProject(p)));
  }

  renderProjects();
</script>
</body>
</html>
